"use strict";var uuid="a70f537b-d0f1-4553-81bb-1767acf549d1";Vue.component("modal-content",{template:'<div class="modal-dialog modal-xl" role="document"> \n      <div class="modal-content border-0">\n        <div class="modal-header bg-dark text-white">\n          <h5 id="exampleModalLabel" class="modal-title">\n            <span>新增產品</span>\n          </h5>\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        <div class="modal-body">\n          <div class="row">\n            <div class="col-sm-4">\n              <div class="form-group">\n                <label for="imageUrl">輸入圖片網址</label>\n                <input id="imageUrl" v-model="tempProduct.imageUrl[0]" type="text" class="form-control"\n                  placeholder="請輸入圖片連結">\n              </div>\n              <img class="img-fluid" :src="tempProduct.imageUrl" alt>\n            </div>\n            <div class="col-sm-8">\n              <div class="form-group">\n                <label for="title">標題</label>\n                <input id="title" v-model="tempProduct.title" type="text" class="form-control" placeholder="請輸入標題">\n              </div>\n\n              <div class="form-row">\n                <div class="form-group col-md-6">\n                  <label for="category">分類</label>\n                  <input id="category" v-model="tempProduct.category" type="text" class="form-control"\n                    placeholder="請輸入分類" >\n                </div>\n                <div class="form-group col-md-6">\n                  <label for="price">單位</label>\n                  <input id="unit" v-model="tempProduct.unit" type="unit" class="form-control"\n                    placeholder="請輸入單位">\n                </div>\n              </div>\n\n              <div class="form-row">\n                <div class="form-group col-md-6">\n                  <label for="origin_price">原價</label>\n                  <input id="origin_price" v-model="tempProduct.origin_price" type="number" class="form-control"\n                    placeholder="請輸入原價">\n                </div>\n                <div class="form-group col-md-6">\n                  <label for="price">售價</label>\n                  <input id="price" v-model="tempProduct.price" type="number" class="form-control"\n                    placeholder="請輸入售價">\n                </div>\n              </div>\n              <hr>\n\n              <div class="form-group">\n                <label for="description">產品描述</label>\n                <textarea id="description" v-model="tempProduct.description" type="text" class="form-control"\n                  placeholder="請輸入產品描述" >\n                </textarea>\n              </div>\n              <div class="form-group">\n                <label for="content">說明內容</label>\n                <textarea id="description" v-model="tempProduct.content" type="text" class="form-control"\n                  placeholder="請輸入說明內容" >\n                </textarea>\n              </div>\n              <div class="form-group">\n                <div class="form-check">\n                  <input id="is_enabled"class="form-check-input" type="checkbox"\n                  v-model="tempProduct.enabled" \n                  :true-value="true" \n                  :false-value="false">\n                  <label class="form-check-label" for="is_enabled">是否啟用</label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">\n            取消\n          </button>\n          <button type="button" class="btn btn-primary" \n          :disabled="componentLoadingBtn === tempProduct.id"\n          @click="updateProduct">\n            <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true" \n            v-if="componentLoadingBtn === tempProduct.id"></span>\n            確認\n          </button>\n        </div>\n      </div>\n    </div>',data:function(){return{componentLoadingBtn:""}},props:["isNew","api-path","uuid","tempProduct"],methods:{updateProduct:function(){var t,e,n=this;!1===this.isNew?(this.componentLoadingBtn=this.tempProduct.id,t="".concat(this.apiPath).concat(this.uuid,"/admin/ec/product/").concat(this.tempProduct.id),axios.patch(t,this.tempProduct).then(function(t){n.$emit("updata"),n.componentLoadingBtn=""})):(this.componentLoadingBtn=this.tempProduct.id,e="".concat(this.apiPath).concat(this.uuid,"/admin/ec/product"),axios.post(e,this.tempProduct).then(function(t){n.$emit("updata"),n.componentLoadingBtn=""}))}}}),Vue.component("pagination",{template:'<ul class="pagination justify-content-end">\n      <li class="page-item" \n        :class="{ disabled: pages.current_page === 1 }"\n      >\n        <a class="page-link" href="#" \n          @click.prevent="updatePage(1)" \n          :disabled="{ true: pages.current_page === 1 }"\n        >最前頁</a>\n      </li>\n      <li class="page-item" \n        v-for="i in pages.total_pages" \n        :key="i"\n        :class="{ active: pages.current_page === i }"\n      >\n        <a class="page-link" href="#" \n          @click.prevent="updatePage(i)"\n        >{{ i }}</a>\n      </li>\n      <li class="page-item"\n        :class="{ disabled: pages.current_page === pages.total_pages }"\n      >\n        <a class="page-link" href="#" \n          @click.prevent="updatePage(pages.total_pages)"\n          :disabled="{ true: pages.current_page === pages.total_pages }"\n        >最後頁</a>\n      </li>\n    </ul>\n  ',props:["pages"],methods:{updatePage:function(t){this.$emit("update-page-num",t)}}}),new Vue({el:"#app",data:{uuid:"",apiPath:"https://course-ec-api.hexschool.io/api/",token:"",user:{email:"",password:""},products:[],pagination:{},tempProduct:{imageUrl:[]},isNew:!1,loadingBtn:""},methods:{signin:function(){var o=this,t="".concat(this.apiPath,"auth/login");axios.post(t,this.user).then(function(t){var e=t.data.token,n=t.data.expired;document.cookie="token=".concat(e,"; expires=").concat(new Date(1e3*n),"; path=/");var a=JSON.parse(t.request.responseText).message;if(alert(a),"登入成功"==a){if(!confirm("登入成功，是否前往後台首頁產品列頁"))return"";window.open("product.html","後台首頁產品列頁"),o.user.password=""}}).catch(function(t){var e=JSON.parse(t.response.request.response);alert(e.message)})},signout:function(){document.cookie="token=; expires=; path=/";alert("完成登出")},getData:function(t){var e,n=this,a=0<arguments.length&&void 0!==t?t:1;this.token=document.cookie.replace(/(?:(?:^|.*;\s*)token\s*\=\s*([^;]*).*$)|^.*$/,"$1"),""==this.token||(e="".concat(this.apiPath).concat(this.uuid,"/admin/ec/products?page=").concat(a),axios.defaults.headers.common.Authorization="Bearer ".concat(this.token),axios.get(e).then(function(t){n.products=t.data.data,n.pagination=t.data.meta.pagination,n.tempProduct.id&&(n.tempProduct={imageUrl:[]},$("#productModal").modal("hide"))}))},openModal:function(t,e){var n=this;switch(t){case"new":this.tempProduct={id:"",unit:"",category:"",title:"",origin_price:Number,price:Number,description:"",content:"",enabled:0,imageUrl:[]},this.tempProduct.id=(new Date).getTime(),this.isNew=!0,$("#productModal").modal("show");break;case"edit":this.loadingBtn=e.id,this.isNew=!1;var a="".concat(this.apiPath).concat(this.uuid,"/admin/ec/product/").concat(e.id);axios.get(a).then(function(t){n.tempProduct=t.data.data,$("#productModal").modal("show"),n.loadingBtn=""});break;case"delete":$("#delProductModal").modal("show"),this.tempProduct=Object.assign({},e)}},delProduct:function(){var a,o=this;this.tempProduct.id&&(a=this.tempProduct.id,this.products.forEach(function(t,e){var n;t.id===a&&(n="".concat(o.apiPath).concat(o.uuid,"/admin/ec/product/").concat(a),axios.delete(n).then(function(t){o.getData()}))})),$("#delProductModal").modal("hide")}},created:function(){this.uuid=uuid,this.token=document.cookie.replace(/(?:(?:^|.*;\s*)token\s*\=\s*([^;]*).*$)|^.*$/,"$1"),axios.defaults.headers.common.Authorization="Bearer ".concat(this.token),this.getData()}});